<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="my-vault">
  <meta name="theme-color" content="#0f0f0f">
  <title>my-vault</title>
  <link rel="manifest" href="manifest.json">
  <style>
    /* ── Reset & base ──────────────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:        #0f0f0f;
      --surface:   #1a1a1a;
      --surface2:  #242424;
      --border:    #2e2e2e;
      --text:      #e8e8e8;
      --text-dim:  #888;
      --accent:    #4f8ef7;
      --danger:    #e05555;
      --success:   #4caf50;
      --radius:    10px;
      --safe-top:  env(safe-area-inset-top, 0px);
      --safe-bot:  env(safe-area-inset-bottom, 0px);
    }
    html, body { height: 100%; background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 15px; overscroll-behavior: none; }
    #app { min-height: 100vh; display: flex; flex-direction: column;
      padding-top: var(--safe-top); padding-bottom: var(--safe-bot); }
    button { cursor: pointer; border: none; background: none; color: inherit; font: inherit; }
    input  { font: inherit; color: var(--text); background: var(--surface2);
      border: 1px solid var(--border); border-radius: var(--radius);
      padding: 10px 12px; width: 100%; outline: none; }
    input:focus { border-color: var(--accent); }
    a { color: var(--accent); }

    /* ── Login ─────────────────────────────────────────────────────────────── */
    .login-logo  { font-size: 64px; text-align: center; margin: 60px 0 12px; }
    .login-title { font-size: 28px; font-weight: 700; text-align: center; }
    .login-sub   { color: var(--text-dim); text-align: center; margin: 8px 20px 24px; font-size: 14px; }
    .login-form  { display: flex; flex-direction: column; gap: 12px;
      padding: 0 24px; max-width: 400px; margin: 0 auto; width: 100%; }
    .pw-input    { font-size: 16px; }  /* ≥16px prevents iOS auto-zoom */
    .btn-primary { background: var(--accent); color: #fff; border-radius: var(--radius);
      padding: 13px; font-size: 16px; font-weight: 600; text-align: center; }
    .btn-primary:disabled { opacity: 0.6; }
    .btn-secondary { background: var(--surface2); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 10px 16px; font-size: 14px; }
    .btn-danger  { background: var(--danger); color: #fff; border-radius: var(--radius);
      padding: 10px 16px; font-size: 14px; }
    .error-msg   { color: var(--danger); font-size: 13px; min-height: 18px; }
    .reset-link  { color: var(--text-dim); font-size: 13px; text-align: center;
      cursor: pointer; text-decoration: underline; margin-top: 4px; }

    /* ── Header ────────────────────────────────────────────────────────────── */
    .app-header  { display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; background: var(--surface); border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 10; }
    .app-title   { font-weight: 700; font-size: 18px; flex: 1; text-align: center; }
    .tbl-title   { cursor: pointer; }
    .tbl-title:hover { color: var(--accent); }
    .header-actions { display: flex; gap: 8px; align-items: center; }
    .icon-btn    { font-size: 18px; padding: 4px 6px; border-radius: 6px; line-height: 1; }
    .icon-btn:hover  { background: var(--surface2); }
    .icon-btn.danger:hover { background: rgba(224,85,85,.15); }
    .back-btn    { font-size: 16px; padding: 4px 8px; color: var(--accent); font-weight: 500; white-space: nowrap; }

    /* ── Sync pill ─────────────────────────────────────────────────────────── */
    .sync-pill   { font-size: 11px; padding: 3px 8px; border-radius: 12px; white-space: nowrap; }
    .sync-local  { background: var(--surface2); color: var(--text-dim); }
    .sync-ok     { background: rgba(76,175,80,.15); color: var(--success); }
    .sync-pending{ background: rgba(255,193,7,.15); color: #ffc107; }

    /* ── Table list ────────────────────────────────────────────────────────── */
    .search-box  { margin: 12px 16px; width: calc(100% - 32px); font-size: 16px; }
    .table-list  { list-style: none; flex: 1; overflow-y: auto; padding-bottom: 80px; }
    .tbl-item    { display: flex; align-items: center; gap: 10px;
      padding: 14px 16px; border-bottom: 1px solid var(--border); cursor: pointer; }
    .tbl-item:active { background: var(--surface2); }
    .tbl-name    { font-weight: 500; flex: 1; }
    .tbl-meta    { font-size: 12px; color: var(--text-dim); white-space: nowrap; }
    .tbl-arrow   { color: var(--text-dim); font-size: 20px; }
    .empty-state { padding: 40px 20px; text-align: center; color: var(--text-dim); }

    /* ── FAB ───────────────────────────────────────────────────────────────── */
    .fab { position: fixed; bottom: calc(24px + var(--safe-bot)); right: 20px;
      width: 56px; height: 56px; border-radius: 50%;
      background: var(--accent); color: #fff; font-size: 28px; font-weight: 300;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 16px rgba(79,142,247,.4); z-index: 20; }
    .fab:active { transform: scale(0.95); }

    /* ── Table editor ──────────────────────────────────────────────────────── */
    .row-count   { display: block; padding: 8px 16px; font-size: 12px; color: var(--text-dim); }
    .add-row-btn { margin: 0 16px 12px; }
    .tbl-scroll  { overflow-x: auto; overflow-y: auto; flex: 1;
      padding-bottom: calc(16px + var(--safe-bot)); }
    .data-tbl    { border-collapse: collapse; min-width: 100%; font-size: 14px; }
    .data-tbl th, .data-tbl td {
      border: 1px solid var(--border); padding: 0; white-space: nowrap; }
    .data-tbl th { background: var(--surface2); font-weight: 600; position: sticky; top: 0; z-index: 5; }
    .data-tbl th:first-child, .data-tbl td:first-child { position: sticky; left: 0; z-index: 4;
      background: var(--surface); }
    .row-num     { min-width: 36px; text-align: center; color: var(--text-dim); }
    .col-name    { display: inline-block; padding: 8px 10px; cursor: pointer; }
    .col-name:hover { color: var(--accent); }
    .col-del     { color: var(--text-dim); font-size: 14px; padding: 4px 6px; vertical-align: middle; }
    .col-del:hover { color: var(--danger); }
    .add-col-btn { padding: 8px 12px; color: var(--accent); font-size: 18px; font-weight: 300; }
    .del-row-btn { color: var(--text-dim); font-size: 14px; padding: 4px 8px; }
    .del-row-btn:hover { color: var(--danger); }
    .cell-val    { display: block; padding: 8px 10px; min-width: 100px; min-height: 36px;
      cursor: pointer; user-select: none; }
    .cell-val:hover { background: rgba(79,142,247,.08); }
    .cell-hidden { color: var(--text-dim); letter-spacing: 2px; }
    .cell-edit   { border: none; border-radius: 0; padding: 8px 10px; min-width: 120px;
      background: rgba(79,142,247,.1); font-size: 14px; }

    /* ── Settings ──────────────────────────────────────────────────────────── */
    .settings-section { margin: 16px; background: var(--surface);
      border-radius: var(--radius); padding: 16px;
      border: 1px solid var(--border); display: flex; flex-direction: column; gap: 10px; }
    .settings-section h2 { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
    .settings-input { font-size: 16px; }
    .settings-note  { font-size: 13px; color: var(--text-dim); line-height: 1.5; }
    .settings-link  { font-size: 13px; }

    /* ── Toast ─────────────────────────────────────────────────────────────── */
    .toast { position: fixed; bottom: calc(80px + var(--safe-bot)); left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 10px 18px; font-size: 13px;
      white-space: nowrap; opacity: 0; transition: opacity .2s, transform .2s; z-index: 100; }
    .toast-show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast-error   { border-color: var(--danger);   color: var(--danger); }
    .toast-success { border-color: var(--success);  color: var(--success); }

    /* ── Scrollbar (desktop) ───────────────────────────────────────────────── */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script src="js/crypto.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/github.js"></script>
  <script src="js/app.js"></script>
  <script src="js/ui.js"></script>
  <script>
    // Show any crash visibly on screen (helps debug)
    window.onerror = (msg, src, line, col, err) => {
      document.getElementById('app').innerHTML =
        `<div style="padding:24px;color:#e05555;font-family:monospace;font-size:13px;white-space:pre-wrap">
ERROR: ${msg}\n${src}:${line}:${col}\n${err?.stack || ''}
        </div>`;
    };
    window.addEventListener('unhandledrejection', e => {
      document.getElementById('app').innerHTML =
        `<div style="padding:24px;color:#e05555;font-family:monospace;font-size:13px;white-space:pre-wrap">
UNHANDLED PROMISE: ${e.reason?.message || e.reason}\n${e.reason?.stack || ''}
        </div>`;
    });

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(console.error);
    }
    // Boot
    UI.showLogin();
  </script>
</body>
</html>
